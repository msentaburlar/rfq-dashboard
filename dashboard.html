<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RFQ-Dashboard 2020-2024</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);min-height:100vh;padding:20px;color:#fff;}
.container{max-width:1400px;margin:0 auto;}
h1{text-align:center;margin-bottom:20px;font-size:2rem;background:linear-gradient(90deg,#3498db,#2ecc71);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.filter-bar{background:rgba(255,255,255,0.1);border-radius:12px;padding:20px;margin-bottom:20px;display:flex;gap:15px;align-items:center;flex-wrap:wrap;}
.filter-bar label{font-weight:600;color:#bdc3c7;}
.filter-bar select{padding:10px 15px;border-radius:8px;border:none;background:#2c3e50;color:#fff;font-size:1rem;cursor:pointer;min-width:150px;}
.filter-bar select:disabled{opacity:0.5;cursor:not-allowed;}
.btn{padding:10px 20px;border:none;border-radius:8px;font-weight:700;cursor:pointer;transition:all 0.3s;font-size:1rem;}
.btn-apply{background:#3498db;color:#fff;}
.btn-apply:hover{background:#2980b9;transform:translateY(-2px);}
.btn-reset{background:#e74c3c;color:#fff;}
.btn-reset:hover{background:#c0392b;transform:translateY(-2px);}
.status-box{background:rgba(46,204,113,0.2);border:1px solid #2ecc71;border-radius:8px;padding:10px 20px;margin-left:auto;font-size:0.95rem;}
.kpi-row{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:20px;}
.kpi-card{background:rgba(255,255,255,0.1);border-radius:12px;padding:25px;text-align:center;backdrop-filter:blur(10px);}
.kpi-card h3{font-size:0.9rem;color:#bdc3c7;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;}
.kpi-card .value{font-size:2.5rem;font-weight:700;}
.kpi-blue .value{color:#3498db;}
.kpi-orange .value{color:#f39c12;}
.kpi-split{display:flex;flex-direction:column;gap:15px;}
.kpi-split .compare-row{display:flex;justify-content:center;align-items:center;gap:15px;font-size:1.3rem;}
.kpi-split .current{color:#2ecc71;font-weight:700;}
.kpi-split .vs{color:#7f8c8d;}
.kpi-split .previous{color:#e74c3c;font-weight:700;}
.kpi-split .diff-row{display:flex;justify-content:center;gap:30px;}
.kpi-split .diff-abs,.kpi-split .diff-pct{font-size:1.1rem;font-weight:600;padding:5px 15px;border-radius:20px;}
.diff-positive{background:rgba(46,204,113,0.2);color:#2ecc71;}
.diff-negative{background:rgba(231,76,60,0.2);color:#e74c3c;}
.charts-row{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:20px;}
.chart-card{background:rgba(255,255,255,0.1);border-radius:12px;padding:20px;backdrop-filter:blur(10px);}
.chart-card h3{font-size:1rem;color:#bdc3c7;margin-bottom:15px;text-align:center;}
.chart-container{height:280px;position:relative;}
.placeholder{display:flex;align-items:center;justify-content:center;height:100%;color:#7f8c8d;font-size:1.1rem;text-align:center;}
.table-section{background:rgba(255,255,255,0.1);border-radius:12px;padding:20px;backdrop-filter:blur(10px);}
.table-section h3{margin-bottom:15px;color:#bdc3c7;}
table{width:100%;border-collapse:collapse;}
th,td{padding:12px;text-align:center;border-bottom:1px solid rgba(255,255,255,0.1);}
th{background:rgba(52,152,219,0.3);font-weight:600;}
tr:hover{background:rgba(255,255,255,0.05);}
.highlight-row{background:rgba(52,152,219,0.2) !important;}
.positive{color:#2ecc71;}
.negative{color:#e74c3c;}
@media(max-width:1000px){.kpi-row,.charts-row{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="container">
<h1>üìä RFQ-Dashboard 2020-2024</h1>

<div class="filter-bar">
<label>Jahr:</label>
<select id="yearFilter">
<option value="">Alle Jahre</option>
<option value="2020">2020</option>
<option value="2021">2021</option>
<option value="2022">2022</option>
<option value="2023">2023</option>
<option value="2024">2024</option>
</select>
<label>Monat:</label>
<select id="monthFilter" disabled>
<option value="">Alle Monate</option>
<option value="1">Januar</option>
<option value="2">Februar</option>
<option value="3">M√§rz</option>
<option value="4">April</option>
<option value="5">Mai</option>
<option value="6">Juni</option>
<option value="7">Juli</option>
<option value="8">August</option>
<option value="9">September</option>
<option value="10">Oktober</option>
<option value="11">November</option>
<option value="12">Dezember</option>
</select>
<button class="btn btn-apply" onclick="applyFilter()">üîç Ausf√ºhren</button>
<button class="btn btn-reset" onclick="resetFilter()">‚Üª Zur√ºcksetzen</button>
<div class="status-box" id="statusBox">üìä Zeige: Alle Daten (37.348 RFQs)</div>
</div>

<div class="kpi-row">
<div class="kpi-card kpi-blue">
<h3>RFQs Gesamt</h3>
<div class="value" id="kpiTotal">37.348</div>
</div>
<div class="kpi-card kpi-split">
<h3>Jahresvergleich</h3>
<div class="compare-row">
<span class="current" id="currentLabel">2024: 3.264</span>
<span class="vs">vs.</span>
<span class="previous" id="previousLabel">2023: 10.945</span>
</div>
<div class="diff-row">
<span class="diff-abs diff-negative" id="diffAbs">-7.681 RFQs</span>
<span class="diff-pct diff-negative" id="diffPct">-70,2%</span>
</div>
</div>
<div class="kpi-card kpi-orange">
<h3>Lieferanten</h3>
<div class="value">2.221</div>
</div>
</div>

<div class="charts-row">
<div class="chart-card">
<h3 id="barTitle">RFQs pro Jahr</h3>
<div class="chart-container" id="barChart"></div>
</div>
<div class="chart-card">
<h3 id="pieTitle">Anteil nach Jahr</h3>
<div class="chart-container" id="pieChart"></div>
</div>
<div class="chart-card">
<h3 id="comboTitle">Monatlicher Vergleich</h3>
<div class="chart-container" id="comboChart">
<div class="placeholder">üìÖ W√§hlen Sie ein Jahr und klicken Sie 'Ausf√ºhren'</div>
</div>
</div>
</div>

<div class="table-section">
<h3>Monatliche Vergleichstabelle</h3>
<table id="dataTable">
<thead>
<tr>
<th>Monat</th>
<th id="thCurrent">2024 üü¢</th>
<th id="thPrevious">2023 üî¥</th>
<th>Differenz</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>
</div>

<script>
const yearlyData={2020:2340,2021:9820,2022:10979,2023:10945,2024:3264};
const monthlyData={
2020:[0,0,17,34,16,37,199,306,224,284,358,430,435],
2021:[0,599,758,909,878,817,824,977,639,896,911,871,741],
2022:[0,743,1115,1166,798,947,991,1074,629,894,951,897,774],
2023:[0,799,817,1020,816,1027,1030,1072,694,947,962,1014,747],
2024:[0,958,1068,1050,188,0,0,0,0,0,0,0,0]
};
const months=['','Januar','Februar','M√§rz','April','Mai','Juni','Juli','August','September','Oktober','November','Dezember'];
const colors={2020:'#9b59b6',2021:'#1abc9c',2022:'#e74c3c',2023:'#3498db',2024:'#2ecc71'};

let currentYear=null,currentMonth=null;

function fmt(n){return n.toLocaleString('de-DE');}

function getTotal(y,m){
if(!y)return Object.values(yearlyData).reduce((a,b)=>a+b,0);
if(!m)return yearlyData[y]||0;
return(monthlyData[y]||[])[m]||0;
}

function getPrevYear(y){return y?parseInt(y)-1:2023;}

function updateKPIs(){
const y=currentYear,m=currentMonth;
const total=getTotal(y,m);
document.getElementById('kpiTotal').textContent=fmt(total);

const currY=y||'2024';
const prevY=getPrevYear(currY);
let currVal,prevVal,currLbl,prevLbl;

if(m){
currVal=(monthlyData[currY]||[])[m]||0;
prevVal=(monthlyData[prevY]||[])[m]||0;
currLbl=months[m]+' '+currY+': '+fmt(currVal);
prevLbl=months[m]+' '+prevY+': '+fmt(prevVal);
}else{
currVal=yearlyData[currY]||0;
prevVal=yearlyData[prevY]||0;
currLbl=currY+': '+fmt(currVal);
prevLbl=prevY+': '+fmt(prevVal);
}

document.getElementById('currentLabel').textContent=currLbl;
document.getElementById('previousLabel').textContent=prevLbl;

const diff=currVal-prevVal;
const pct=prevVal?((diff/prevVal)*100).toFixed(1):0;
const absEl=document.getElementById('diffAbs');
const pctEl=document.getElementById('diffPct');

absEl.textContent=(diff>=0?'+':'')+fmt(diff)+' RFQs';
pctEl.textContent=(diff>=0?'+':'')+pct.replace('.',',')+'%';
absEl.className='diff-abs '+(diff>=0?'diff-positive':'diff-negative');
pctEl.className='diff-pct '+(diff>=0?'diff-positive':'diff-negative');
}

function drawBarChart(){
const svg=document.getElementById('barChart');
const y=currentYear,m=currentMonth;
let data=[],title='';

if(!y){
data=Object.entries(yearlyData).map(([yr,v])=>({label:yr,value:v,color:colors[yr]}));
title='RFQs pro Jahr';
}else{
const prevY=getPrevYear(y);
if(m){
data=[
{label:months[m]+' '+prevY,value:(monthlyData[prevY]||[])[m]||0,color:'#e74c3c'},
{label:months[m]+' '+y,value:(monthlyData[y]||[])[m]||0,color:'#2ecc71'}
];
title=months[m]+' '+y+' vs. '+months[m]+' '+prevY;
}else{
data=[
{label:String(prevY),value:yearlyData[prevY]||0,color:'#e74c3c'},
{label:String(y),value:yearlyData[y]||0,color:'#2ecc71'}
];
title=y+' vs. '+prevY;
}}

document.getElementById('barTitle').textContent=title;
const maxVal=Math.max(...data.map(d=>d.value),1);
const w=svg.clientWidth,h=260;
const barW=Math.min(60,w/(data.length*2));
const gap=(w-barW*data.length)/(data.length+1);

let html=`<svg width="${w}" height="${h}">`;
for(let i=0;i<4;i++){
const yPos=h-30-(i*(h-50)/3);
const val=Math.round(maxVal*i/3);
html+=`<line x1="40" y1="${yPos}" x2="${w-10}" y2="${yPos}" stroke="rgba(255,255,255,0.1)"/>`;
html+=`<text x="35" y="${yPos+4}" fill="#7f8c8d" font-size="11" text-anchor="end">${val>=1000?(val/1000).toFixed(0)+'K':val}</text>`;
}
data.forEach((d,i)=>{
const barH=(d.value/maxVal)*(h-60);
const x=gap+(gap+barW)*i;
const barY=h-30-barH;
html+=`<rect x="${x}" y="${barY}" width="${barW}" height="${barH}" fill="${d.color}" rx="4"/>`;
html+=`<text x="${x+barW/2}" y="${barY-8}" fill="#fff" font-size="12" font-weight="600" text-anchor="middle">${fmt(d.value)}</text>`;
html+=`<text x="${x+barW/2}" y="${h-10}" fill="#bdc3c7" font-size="11" text-anchor="middle">${d.label}</text>`;
});
html+='</svg>';
svg.innerHTML=html;
}

function drawPieChart(){
const svg=document.getElementById('pieChart');
const y=currentYear,m=currentMonth;
let data=[];

if(!y){
const total=Object.values(yearlyData).reduce((a,b)=>a+b,0);
data=Object.entries(yearlyData).map(([yr,v])=>({label:yr,value:v,pct:((v/total)*100).toFixed(1),color:colors[yr]}));
}else{
const prevY=getPrevYear(y);
let currVal,prevVal;
if(m){
currVal=(monthlyData[y]||[])[m]||0;
prevVal=(monthlyData[prevY]||[])[m]||0;
}else{
currVal=yearlyData[y]||0;
prevVal=yearlyData[prevY]||0;
}
const total=currVal+prevVal||1;
data=[
{label:m?months[m]+' '+y:String(y),value:currVal,pct:((currVal/total)*100).toFixed(1),color:'#2ecc71'},
{label:m?months[m]+' '+prevY:String(prevY),value:prevVal,pct:((prevVal/total)*100).toFixed(1),color:'#e74c3c'}
];
}

const w=svg.clientWidth,h=260;
const cx=w/2,cy=h/2-10,r=80;
let html=`<svg width="${w}" height="${h}">`;
let startAngle=-Math.PI/2;
const total=data.reduce((a,d)=>a+d.value,0)||1;

data.forEach(d=>{
const angle=(d.value/total)*2*Math.PI;
const endAngle=startAngle+angle;
const large=angle>Math.PI?1:0;
const x1=cx+r*Math.cos(startAngle),y1=cy+r*Math.sin(startAngle);
const x2=cx+r*Math.cos(endAngle),y2=cy+r*Math.sin(endAngle);
if(d.value>0){
html+=`<path d="M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${large} 1 ${x2},${y2} Z" fill="${d.color}"/>`;
const midAngle=startAngle+angle/2;
const tx=cx+(r+25)*Math.cos(midAngle),ty=cy+(r+25)*Math.sin(midAngle);
html+=`<text x="${tx}" y="${ty}" fill="#fff" font-size="11" text-anchor="middle">${d.pct.replace('.',',')}%</text>`;
}
startAngle=endAngle;
});

let ly=h-35;
data.forEach(d=>{
html+=`<rect x="10" y="${ly}" width="12" height="12" fill="${d.color}" rx="2"/>`;
html+=`<text x="26" y="${ly+10}" fill="#bdc3c7" font-size="11">${d.label}: ${fmt(d.value)}</text>`;
ly+=16;
});
html+='</svg>';
svg.innerHTML=html;
}

function drawComboChart(){
const svg=document.getElementById('comboChart');
const y=currentYear;
if(!y){
svg.innerHTML='<div class="placeholder">üìÖ W√§hlen Sie ein Jahr und klicken Sie \\'Ausf√ºhren\\'</div>';
document.getElementById('comboTitle').textContent='Monatlicher Vergleich';
return;
}

const prevY=getPrevYear(y);
document.getElementById('comboTitle').textContent='Monatlicher Vergleich '+y+' vs. '+prevY;

const currData=monthlyData[y]||[];
const prevData=monthlyData[prevY]||[];
const allVals=[...currData.slice(1),...prevData.slice(1)];
const maxVal=Math.max(...allVals,1);

const w=svg.clientWidth,h=260;
const barW=Math.min(25,(w-80)/12);
const gap=((w-60)-barW*12)/13;

let html=`<svg width="${w}" height="${h}">`;
for(let i=0;i<4;i++){
const yPos=h-35-(i*(h-60)/3);
const val=Math.round(maxVal*i/3);
html+=`<line x1="40" y1="${yPos}" x2="${w-10}" y2="${yPos}" stroke="rgba(255,255,255,0.1)"/>`;
html+=`<text x="35" y="${yPos+4}" fill="#7f8c8d" font-size="10" text-anchor="end">${val>=1000?(val/1000).toFixed(0)+'K':val}</text>`;
}

const selectedM=currentMonth?parseInt(currentMonth):null;
let linePoints=[];

for(let i=1;i<=12;i++){
const x=45+gap*i+barW*(i-1);
const currV=currData[i]||0;
const prevV=prevData[i]||0;
const barH=(currV/maxVal)*(h-70);
const barY=h-35-barH;

const isSelected=selectedM===i;
const bw=isSelected?barW+4:barW;
const bx=isSelected?x-2:x;

html+=`<rect x="${bx}" y="${barY}" width="${bw}" height="${barH}" fill="${isSelected?'#27ae60':'#2ecc71'}" rx="3" opacity="${isSelected?1:0.8}"/>`;
if(currV>0)html+=`<text x="${x+barW/2}" y="${barY-5}" fill="#2ecc71" font-size="9" text-anchor="middle">${currV>=1000?(currV/1000).toFixed(1)+'K':currV}</text>`;

const lineY=h-35-(prevV/maxVal)*(h-70);
linePoints.push({x:x+barW/2,y:lineY,v:prevV});
html+=`<text x="${x+barW/2}" y="${h-22}" fill="#7f8c8d" font-size="9" text-anchor="middle">${months[i].substr(0,3)}</text>`;
}

if(linePoints.length>1){
let path='M'+linePoints.map(p=>p.x+','+p.y).join(' L');
html+=`<path d="${path}" stroke="#e74c3c" stroke-width="2" fill="none"/>`;
linePoints.forEach(p=>{
html+=`<circle cx="${p.x}" cy="${p.y}" r="4" fill="#e74c3c"/>`;
if(p.v>0)html+=`<text x="${p.x}" y="${p.y-8}" fill="#e74c3c" font-size="8" text-anchor="middle">${p.v>=1000?(p.v/1000).toFixed(1)+'K':p.v}</text>`;
});
}

html+=`<rect x="${w-120}" y="5" width="12" height="12" fill="#2ecc71" rx="2"/><text x="${w-105}" y="14" fill="#bdc3c7" font-size="10">${y}</text>`;
html+=`<rect x="${w-60}" y="5" width="12" height="12" fill="#e74c3c" rx="2"/><text x="${w-45}" y="14" fill="#bdc3c7" font-size="10">${prevY}</text>`;
html+='</svg>';
svg.innerHTML=html;
}

function updateTable(){
const y=currentYear||'2024';
const prevY=getPrevYear(y);
const currData=monthlyData[y]||[];
const prevData=monthlyData[prevY]||[];

document.getElementById('thCurrent').textContent=y+' üü¢';
document.getElementById('thPrevious').textContent=prevY+' üî¥';

const selectedM=currentMonth?parseInt(currentMonth):null;
let html='';
for(let i=1;i<=12;i++){
const curr=currData[i]||0;
const prev=prevData[i]||0;
const diff=curr-prev;
const cls=selectedM===i?'highlight-row':'';
const diffCls=diff>=0?'positive':'negative';
html+=`<tr class="${cls}"><td>${months[i]}</td><td>${fmt(curr)}</td><td>${fmt(prev)}</td><td class="${diffCls}">${diff>=0?'+':''}${fmt(diff)}</td></tr>`;
}
document.getElementById('tableBody').innerHTML=html;
}

function updateStatus(){
const y=currentYear,m=currentMonth;
const total=getTotal(y,m);
let text='';
if(!y)text='üìä Zeige: Alle Daten ('+fmt(total)+' RFQs)';
else if(!m)text='‚úÖ Zeige: Jahr '+y+' ('+fmt(total)+' RFQs)';
else text='‚úÖ Zeige: '+months[m]+' '+y+' ('+fmt(total)+' RFQs)';
document.getElementById('statusBox').textContent=text;
}

function applyFilter(){
currentYear=document.getElementById('yearFilter').value||null;
currentMonth=document.getElementById('monthFilter').value||null;
updateAll();
}

function resetFilter(){
document.getElementById('yearFilter').value='';
document.getElementById('monthFilter').value='';
document.getElementById('monthFilter').disabled=true;
currentYear=null;
currentMonth=null;
updateAll();
}

function updateAll(){
updateKPIs();
drawBarChart();
drawPieChart();
drawComboChart();
updateTable();
updateStatus();
}

document.getElementById('yearFilter').addEventListener('change',function(){
const mf=document.getElementById('monthFilter');
if(this.value){mf.disabled=false;}else{mf.disabled=true;mf.value='';}
});

window.addEventListener('resize',()=>{drawBarChart();drawPieChart();drawComboChart();});
updateAll();
</script>
</body>
</html>