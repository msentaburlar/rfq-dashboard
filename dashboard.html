<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RFQ Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .header h1 {
            color: #1a365d;
            font-size: 2.2em;
            margin-bottom: 8px;
        }
        .header p {
            color: #64748b;
            font-size: 1.1em;
        }
        .filter-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .filter-section h3 {
            color: #1a365d;
            margin-bottom: 20px;
            font-size: 1.2em;
        }
        .filter-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        .filter-group {
            flex: 1;
            min-width: 180px;
        }
        .filter-group label {
            display: block;
            color: #475569;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .filter-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
            color: #334155;
            background: #f8fafc;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .filter-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
        }
        .button-group {
            display: flex;
            gap: 12px;
            flex-shrink: 0;
        }
        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59,130,246,0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
        }
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(100,116,139,0.4);
        }
        .kpi-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .kpi-card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
        }
        .kpi-card.total::before {
            background: linear-gradient(180deg, #3b82f6, #1d4ed8);
        }
        .kpi-card.period::before {
            background: linear-gradient(180deg, #10b981, #059669);
        }
        .kpi-label {
            color: #64748b;
            font-size: 0.95em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }
        .kpi-value {
            font-size: 3em;
            font-weight: 700;
            color: #1a365d;
            margin-bottom: 8px;
        }
        .kpi-comparison {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95em;
            font-weight: 600;
        }
        .kpi-comparison.positive {
            color: #10b981;
        }
        .kpi-comparison.negative {
            color: #ef4444;
        }
        .kpi-comparison.neutral {
            color: #64748b;
        }
        .comparison-icon {
            font-size: 1.2em;
        }
        .kpi-sublabel {
            color: #94a3b8;
            font-size: 0.85em;
            margin-top: 4px;
        }
        .chart-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        .chart-header h3 {
            color: #1a365d;
            font-size: 1.3em;
        }
        .chart-legend {
            display: flex;
            gap: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
            color: #475569;
        }
        .legend-bar {
            width: 20px;
            height: 12px;
            border-radius: 3px;
            background: #3b82f6;
        }
        .legend-line {
            width: 20px;
            height: 3px;
            border-radius: 2px;
            background: #f97316;
        }
        .chart-container {
            position: relative;
            height: 400px;
        }
        @media (max-width: 768px) {
            .filter-row {
                flex-direction: column;
            }
            .button-group {
                width: 100%;
                justify-content: center;
            }
            .kpi-value {
                font-size: 2.2em;
            }
            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>üìä RFQ Dashboard</h1>
            <p>Interaktive Analyse der Request for Quotations</p>
        </div>

        <div class="filter-section">
            <h3>üîç Filteroptionen</h3>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="yearFilter">Jahr</label>
                    <select id="yearFilter">
                        <option value="">Alle Jahre</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="monthFilter">Monat</label>
                    <select id="monthFilter">
                        <option value="">Alle Monate</option>
                        <option value="1">Januar</option>
                        <option value="2">Februar</option>
                        <option value="3">M√§rz</option>
                        <option value="4">April</option>
                        <option value="5">Mai</option>
                        <option value="6">Juni</option>
                        <option value="7">Juli</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">Oktober</option>
                        <option value="11">November</option>
                        <option value="12">Dezember</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="applyFilters()">
                        ‚ñ∂ Ausf√ºhren
                    </button>
                    <button class="btn btn-secondary" onclick="resetFilters()">
                        ‚Ü∫ Zur√ºcksetzen
                    </button>
                </div>
            </div>
        </div>

        <div class="kpi-section">
            <div class="kpi-card total">
                <div class="kpi-label">Gesamtanzahl RFQs</div>
                <div class="kpi-value" id="totalRfqs">37.348</div>
                <div class="kpi-sublabel">Alle verf√ºgbaren RFQs im System</div>
            </div>
            <div class="kpi-card period">
                <div class="kpi-label" id="periodLabel">Ausgew√§hlter Zeitraum</div>
                <div class="kpi-value" id="periodRfqs">-</div>
                <div class="kpi-comparison neutral" id="comparison">
                    <span class="comparison-icon">‚Üí</span>
                    <span id="comparisonText">W√§hlen Sie einen Zeitraum</span>
                </div>
                <div class="kpi-sublabel" id="comparisonSubtext"></div>
            </div>
        </div>

        <div class="chart-section">
            <div class="chart-header">
                <h3 id="chartTitle">üìà RFQ √úbersicht nach Monaten</h3>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-bar"></div>
                        <span id="legendCurrent">Aktuell</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line"></div>
                        <span id="legendPrevious">Vorjahr/Vormonat</span>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="rfqChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const rawData = [
            {year: 2024, month: 4, count: 188},
            {year: 2024, month: 3, count: 1050},
            {year: 2024, month: 2, count: 1068},
            {year: 2024, month: 1, count: 958},
            {year: 2023, month: 12, count: 747},
            {year: 2023, month: 11, count: 1014},
            {year: 2023, month: 10, count: 962},
            {year: 2023, month: 9, count: 947},
            {year: 2023, month: 8, count: 694},
            {year: 2023, month: 7, count: 1072},
            {year: 2023, month: 6, count: 1030},
            {year: 2023, month: 5, count: 1027},
            {year: 2023, month: 4, count: 816},
            {year: 2023, month: 3, count: 1020},
            {year: 2023, month: 2, count: 817},
            {year: 2023, month: 1, count: 799},
            {year: 2022, month: 12, count: 774},
            {year: 2022, month: 11, count: 897},
            {year: 2022, month: 10, count: 951},
            {year: 2022, month: 9, count: 894},
            {year: 2022, month: 8, count: 629},
            {year: 2022, month: 7, count: 1074},
            {year: 2022, month: 6, count: 991},
            {year: 2022, month: 5, count: 947},
            {year: 2022, month: 4, count: 798},
            {year: 2022, month: 3, count: 1166},
            {year: 2022, month: 2, count: 1115},
            {year: 2022, month: 1, count: 743},
            {year: 2021, month: 12, count: 741},
            {year: 2021, month: 11, count: 871},
            {year: 2021, month: 10, count: 911},
            {year: 2021, month: 9, count: 896},
            {year: 2021, month: 8, count: 639},
            {year: 2021, month: 7, count: 977},
            {year: 2021, month: 6, count: 824},
            {year: 2021, month: 5, count: 817},
            {year: 2021, month: 4, count: 878},
            {year: 2021, month: 3, count: 909},
            {year: 2021, month: 2, count: 758},
            {year: 2021, month: 1, count: 599},
            {year: 2020, month: 12, count: 435},
            {year: 2020, month: 11, count: 430},
            {year: 2020, month: 10, count: 358},
            {year: 2020, month: 9, count: 284},
            {year: 2020, month: 8, count: 224},
            {year: 2020, month: 7, count: 306},
            {year: 2020, month: 6, count: 199},
            {year: 2020, month: 5, count: 37},
            {year: 2020, month: 4, count: 16},
            {year: 2020, month: 3, count: 34},
            {year: 2020, month: 2, count: 17}
        ];

        const monthNames = ['Jan', 'Feb', 'M√§r', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'];
        const monthNamesFull = ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
        const totalRfqs = 37348;

        let rfqChart = null;

        function getDataForYear(year) {
            return rawData.filter(d => d.year === parseInt(year)).sort((a, b) => a.month - b.month);
        }

        function getDataForYearMonth(year, month) {
            return rawData.find(d => d.year === parseInt(year) && d.month === parseInt(month));
        }

        function getTotalForYear(year) {
            return rawData.filter(d => d.year === parseInt(year)).reduce((sum, d) => sum + d.count, 0);
        }

        function formatNumber(num) {
            return num.toLocaleString('de-DE');
        }

        function calculateComparison(current, previous) {
            if (!previous || previous === 0) return { diff: 0, percent: 0 };
            const diff = current - previous;
            const percent = ((diff / previous) * 100).toFixed(1);
            return { diff, percent };
        }

        function updateKPIs(selectedYear, selectedMonth) {
            const periodLabel = document.getElementById('periodLabel');
            const periodRfqs = document.getElementById('periodRfqs');
            const comparison = document.getElementById('comparison');
            const comparisonText = document.getElementById('comparisonText');
            const comparisonSubtext = document.getElementById('comparisonSubtext');

            if (!selectedYear && !selectedMonth) {
                periodLabel.textContent = 'Ausgew√§hlter Zeitraum';
                periodRfqs.textContent = '-';
                comparison.className = 'kpi-comparison neutral';
                comparisonText.textContent = 'W√§hlen Sie einen Zeitraum';
                comparisonSubtext.textContent = '';
                return;
            }

            let currentValue = 0;
            let previousValue = 0;
            let compLabel = '';
            let prevLabel = '';

            if (selectedYear && selectedMonth) {
                // Specific month selected - compare to previous month
                const currentData = getDataForYearMonth(selectedYear, selectedMonth);
                currentValue = currentData ? currentData.count : 0;

                let prevYear = parseInt(selectedYear);
                let prevMonth = parseInt(selectedMonth) - 1;
                if (prevMonth === 0) {
                    prevMonth = 12;
                    prevYear--;
                }
                const prevData = getDataForYearMonth(prevYear, prevMonth);
                previousValue = prevData ? prevData.count : 0;

                periodLabel.textContent = `RFQs ${monthNamesFull[selectedMonth - 1]} ${selectedYear}`;
                compLabel = 'zum Vormonat';
                prevLabel = `(${monthNamesFull[prevMonth - 1]} ${prevYear}: ${formatNumber(previousValue)})`;
            } else if (selectedYear) {
                // Year selected - compare to previous year
                currentValue = getTotalForYear(selectedYear);
                previousValue = getTotalForYear(parseInt(selectedYear) - 1);
                periodLabel.textContent = `RFQs Jahr ${selectedYear}`;
                compLabel = 'zum Vorjahr';
                prevLabel = `(${parseInt(selectedYear) - 1}: ${formatNumber(previousValue)})`;
            } else if (selectedMonth) {
                // Only month selected - show all years for this month
                currentValue = rawData.filter(d => d.month === parseInt(selectedMonth)).reduce((sum, d) => sum + d.count, 0);
                periodLabel.textContent = `RFQs ${monthNamesFull[selectedMonth - 1]} (alle Jahre)`;
                comparison.className = 'kpi-comparison neutral';
                periodRfqs.textContent = formatNumber(currentValue);
                comparisonText.textContent = 'Gesamt √ºber alle Jahre';
                comparisonSubtext.textContent = '';
                return;
            }

            periodRfqs.textContent = formatNumber(currentValue);

            const comp = calculateComparison(currentValue, previousValue);
            if (comp.diff > 0) {
                comparison.className = 'kpi-comparison positive';
                comparisonText.innerHTML = `<span class="comparison-icon">‚Üë</span> +${formatNumber(comp.diff)} (${comp.percent}%) ${compLabel}`;
            } else if (comp.diff < 0) {
                comparison.className = 'kpi-comparison negative';
                comparisonText.innerHTML = `<span class="comparison-icon">‚Üì</span> ${formatNumber(comp.diff)} (${comp.percent}%) ${compLabel}`;
            } else {
                comparison.className = 'kpi-comparison neutral';
                comparisonText.innerHTML = `<span class="comparison-icon">‚Üí</span> Keine √Ñnderung ${compLabel}`;
            }
            comparisonSubtext.textContent = prevLabel;
        }

        function updateChart(selectedYear, selectedMonth) {
            const ctx = document.getElementById('rfqChart').getContext('2d');
            const chartTitle = document.getElementById('chartTitle');
            const legendCurrent = document.getElementById('legendCurrent');
            const legendPrevious = document.getElementById('legendPrevious');

            let labels = [];
            let currentData = [];
            let previousData = [];

            if (selectedYear && selectedMonth) {
                // Show daily breakdown or week view - simplified to show month comparison
                const prevYear = parseInt(selectedYear) - 1;
                labels = [monthNamesFull[selectedMonth - 1]];
                const curr = getDataForYearMonth(selectedYear, selectedMonth);
                const prev = getDataForYearMonth(prevYear, selectedMonth);
                currentData = [curr ? curr.count : 0];
                previousData = [prev ? prev.count : 0];
                chartTitle.textContent = `üìà RFQ Vergleich: ${monthNamesFull[selectedMonth - 1]} ${selectedYear} vs ${prevYear}`;
                legendCurrent.textContent = selectedYear;
                legendPrevious.textContent = prevYear;

                // Better: show all months for comparison
                labels = monthNames;
                const yearData = getDataForYear(selectedYear);
                const prevYearData = getDataForYear(prevYear);
                currentData = monthNames.map((_, i) => {
                    const d = yearData.find(x => x.month === i + 1);
                    return d ? d.count : 0;
                });
                previousData = monthNames.map((_, i) => {
                    const d = prevYearData.find(x => x.month === i + 1);
                    return d ? d.count : 0;
                });
                chartTitle.textContent = `üìà RFQ Vergleich: ${selectedYear} vs ${prevYear} (${monthNamesFull[selectedMonth - 1]} markiert)`;
            } else if (selectedYear) {
                // Show monthly breakdown for selected year
                const prevYear = parseInt(selectedYear) - 1;
                labels = monthNames;
                const yearData = getDataForYear(selectedYear);
                const prevYearData = getDataForYear(prevYear);
                currentData = monthNames.map((_, i) => {
                    const d = yearData.find(x => x.month === i + 1);
                    return d ? d.count : 0;
                });
                previousData = monthNames.map((_, i) => {
                    const d = prevYearData.find(x => x.month === i + 1);
                    return d ? d.count : 0;
                });
                chartTitle.textContent = `üìà RFQ Vergleich: ${selectedYear} vs ${prevYear}`;
                legendCurrent.textContent = selectedYear;
                legendPrevious.textContent = prevYear;
            } else if (selectedMonth) {
                // Show year-over-year for selected month
                const years = [2020, 2021, 2022, 2023, 2024];
                labels = years.map(String);
                currentData = years.map(y => {
                    const d = getDataForYearMonth(y, selectedMonth);
                    return d ? d.count : 0;
                });
                previousData = [];
                chartTitle.textContent = `üìà RFQ Entwicklung: ${monthNamesFull[selectedMonth - 1]} √ºber alle Jahre`;
                legendCurrent.textContent = monthNamesFull[selectedMonth - 1];
                legendPrevious.textContent = '-';
            } else {
                // Default: Show all years summary
                const years = [2020, 2021, 2022, 2023, 2024];
                labels = years.map(String);
                currentData = years.map(y => getTotalForYear(y));
                previousData = [];
                chartTitle.textContent = 'üìà RFQ √úbersicht nach Jahren';
                legendCurrent.textContent = 'RFQs pro Jahr';
                legendPrevious.textContent = '-';
            }

            if (rfqChart) {
                rfqChart.destroy();
            }

            const datasets = [{
                type: 'bar',
                label: legendCurrent.textContent,
                data: currentData,
                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                borderColor: 'rgba(59, 130, 246, 1)',
                borderWidth: 2,
                borderRadius: 6,
                order: 2
            }];

            if (previousData.length > 0 && previousData.some(v => v > 0)) {
                datasets.push({
                    type: 'line',
                    label: legendPrevious.textContent,
                    data: previousData,
                    borderColor: 'rgba(249, 115, 22, 1)',
                    backgroundColor: 'rgba(249, 115, 22, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: 'rgba(249, 115, 22, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    tension: 0.3,
                    fill: false,
                    order: 1
                });
            }

            rfqChart = new Chart(ctx, {
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 54, 93, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatNumber(context.raw) + ' RFQs';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.05)'
                            },
                            ticks: {
                                color: '#64748b',
                                callback: function(value) {
                                    return formatNumber(value);
                                }
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#64748b'
                            }
                        }
                    }
                }
            });
        }

        function applyFilters() {
            const selectedYear = document.getElementById('yearFilter').value;
            const selectedMonth = document.getElementById('monthFilter').value;
            updateKPIs(selectedYear, selectedMonth);
            updateChart(selectedYear, selectedMonth);
        }

        function resetFilters() {
            document.getElementById('yearFilter').value = '';
            document.getElementById('monthFilter').value = '';
            updateKPIs('', '');
            updateChart('', '');
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateChart('', '');
        });
    </script>
</body>
</html>